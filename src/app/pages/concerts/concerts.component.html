<section class="concerts-page">
  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">{{ getTranslation('concerts.title') }}</h1>
    </div>
    <!-- Tabs -->
    <div class="tabs">
      <button 
        class="tab-btn" 
        [class.active]="activeTab() === 'upcoming'"
        (click)="setActiveTab('upcoming')">
        {{ getTranslation('concerts.upcoming') }}
      </button>
      <button 
        class="tab-btn" 
        [class.active]="activeTab() === 'archive'"
        (click)="setActiveTab('archive')">
        {{ getTranslation('concerts.archive') }}
      </button>
    </div>

    <!-- Archive Year Tabs (shown only when archive is active) -->
    <div class="archive-year-tabs" *ngIf="activeTab() === 'archive' && availableYears().length > 1">
      <button 
        class="year-tab-btn" 
        [class.active]="activeArchiveYear() === 'all'"
        (click)="setActiveArchiveYear('all')">
        Wszystkie
      </button>
      <button 
        *ngFor="let year of availableYears()"
        class="year-tab-btn" 
        [class.active]="activeArchiveYear() === year.toString()"
        (click)="setActiveArchiveYear(year.toString())">
        {{ year }}
      </button>
    </div>

    <div class="concerts-container">
      <div class="concerts-grid" *ngIf="getConcerts().length > 0; else noConcerts">
        <div class="concert-card" *ngFor="let concert of getConcerts()">
          <div class="concert-image">
            <ng-container *ngIf="concert.poster?.asset?.url as posterUrl; else placeholder">
              <img [src]="posterUrl" [alt]="concert.poster?.alt || getLocalizedTitle(concert)" />
            </ng-container>
            <div class="ticket-type-badge" *ngIf="getTicketingType(concert) === 'free' && activeTab() === 'upcoming'">
              <i class="fas fa-ticket-alt"></i>
              {{ getTranslation('concerts.freeEntry') }}
            </div>
            <ng-template #placeholder>
              <div class="image-placeholder">
                <i class="fas fa-calendar-alt"></i>
                <span>{{ getLocalizedTitle(concert) }}</span>
              </div>
            </ng-template>
          </div>
          
          <div class="concert-details">
            <h3 class="concert-title">{{ getLocalizedTitle(concert) }}</h3>
            
            <div class="concert-info">
              <div class="info-item">
                <i class="fas fa-calendar"></i>
                <span>{{ formatDate(concert.date) }}</span>
              </div>
              
              <div class="info-item" *ngIf="concert.time">
                <i class="fas fa-clock"></i>
                <span>{{ concert.time }}</span>
              </div>
              
              <div class="info-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>{{ getLocalizedLocation(concert) }}, {{ getLocalizedVenue(concert) }}</span>
              </div>

              <!-- Explicit info line for free entry (only for upcoming concerts) -->
              <div class="info-item" *ngIf="getTicketingType(concert) === 'free' && activeTab() === 'upcoming'">
                <i class="fas fa-ticket-alt"></i>
                <span>{{ getTranslation('concerts.freeEntry') }}</span>
              </div>
            </div>
            
            <div class="concert-program" *ngIf="getLocalizedProgram(concert)">
              <h4>{{ getTranslation('concerts.program') }}</h4>
              <p>{{ getLocalizedProgram(concert) }}</p>
            </div>
            
            <div class="concert-actions">
              <!-- Price information for paid concerts -->
              <div class="concert-price" *ngIf="getTicketingType(concert) === 'paid' && getLocalizedPrice(concert)">
                <span class="price-label">{{ getTranslation('concerts.price') }}:</span>
                <span class="price-value">{{ getLocalizedPrice(concert) }}</span>
              </div>

              <!-- Action buttons -->
              <div class="action-buttons" *ngIf="activeTab() === 'upcoming'">
                <!-- Free entry concert -->
                <ng-container *ngIf="getTicketingType(concert) === 'free'">
                  <span class="free-entry-badge">
                    <i class="fas fa-gift"></i>
                    {{ getTranslation('concerts.freeEntry') }}
                  </span>
                  <a 
                    *ngIf="getEventLink(concert)" 
                    [href]="getEventLink(concert)!" 
                    target="_blank" 
                    class="btn btn-secondary">
                    <i class="fas fa-info-circle"></i>
                    {{ getTranslation('concerts.moreInfo') }}
                  </a>
                </ng-container>

                <!-- Paid tickets concert -->
                <ng-container *ngIf="getTicketingType(concert) === 'paid'">
                  <a 
                    *ngIf="getTicketLink(concert)" 
                    [href]="getTicketLink(concert)!" 
                    target="_blank" 
                    class="btn btn-primary">
                    <i class="fas fa-ticket-alt"></i>
                    {{ getTranslation('concerts.tickets') }}
                  </a>
                  <a 
                    *ngIf="getEventLink(concert)" 
                    [href]="getEventLink(concert)!" 
                    target="_blank" 
                    class="btn btn-secondary">
                    <i class="fas fa-calendar-alt"></i>
                    {{ getTranslation('concerts.eventPage') }}
                  </a>
                </ng-container>

                <!-- Registration required concert -->
                <ng-container *ngIf="getTicketingType(concert) === 'registration'">
                  <a 
                    *ngIf="getRegistrationLink(concert)" 
                    [href]="getRegistrationLink(concert)!" 
                    target="_blank" 
                    class="btn btn-primary">
                    <i class="fas fa-user-plus"></i>
                    {{ getTranslation('concerts.register') }}
                  </a>
                  <a 
                    *ngIf="getEventLink(concert)" 
                    [href]="getEventLink(concert)!" 
                    target="_blank" 
                    class="btn btn-secondary">
                    <i class="fas fa-info-circle"></i>
                    {{ getTranslation('concerts.moreInfo') }}
                  </a>
                </ng-container>

                <!-- Legacy support for old ticketLink -->
                <ng-container *ngIf="!getTicketingType(concert) && getTicketLink(concert)">
                  <a 
                    [href]="getTicketLink(concert)!" 
                    target="_blank" 
                    class="btn btn-primary">
                    <i class="fas fa-ticket-alt"></i>
                    {{ getTranslation('concerts.tickets') }}
                  </a>
                </ng-container>
              </div>

              <!-- Archive tab: Show only event link if available -->
              <div class="action-buttons" *ngIf="activeTab() === 'archive' && getEventLink(concert)">
                <a 
                  [href]="getEventLink(concert)!" 
                  target="_blank" 
                  class="btn btn-secondary">
                  <i class="fas fa-info-circle"></i>
                  {{ getTranslation('concerts.moreInfo') }}
                </a>
              </div>
              
              <div class="concert-images" *ngIf="concert.images && concert.images.length > 0">
                <h4>{{ getTranslation('gallery.concerts') }}</h4>
                <div class="images-preview">
                  <ng-container *ngFor="let image of concert.images | slice:0:4; let last = last; let i = index">
                    <div class="preview-item" [class.more-overlay]="i === 3 && concert.images!.length > 4">
                      <img *ngIf="image.asset?.url" [src]="image.asset.url" alt="Concert Image" />
                      <a *ngIf="i === 3 && concert.images!.length > 4" routerLink="/gallery" class="see-more">
                        {{ getTranslation('home.upcomingConcerts.viewAll') }}
                      </a>
                    </div>
                  </ng-container>
                </div>
                <div class="see-more-row" *ngIf="concert.images.length > 0">
                  <a routerLink="/gallery" class="btn-link">{{ getTranslation('home.upcomingConcerts.viewAll') }}</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <ng-template #noConcerts>
        <div class="no-concerts">
          <div class="no-concerts-content">
            <i class="fas fa-music"></i>
            <h3>{{ getTranslation('concerts.noConcerts') }}</h3>
            <p *ngIf="activeTab() === 'upcoming'">{{ getTranslation('concerts.noConcerts') }}</p>
            <p *ngIf="activeTab() === 'archive'">{{ getTranslation('concerts.archive') }}</p>
          </div>
        </div>
      </ng-template>
    </div>
  </div>
</section> 