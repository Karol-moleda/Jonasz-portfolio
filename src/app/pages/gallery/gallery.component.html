<section class="gallery-page">
  <div class="container">

    <div class="page-header">
      <h1 class="page-title">{{ getTranslation('gallery.title') }}</h1>
    </div>

    <div class="gallery-filters" *ngIf="galleries().length > 0 && !isMobile">
      <button
        *ngFor="let gallery of galleries()"
        class="filter-btn"
        [class.active]="activeTab() === gallery._id"
        (click)="setActiveTab(gallery._id)"
      >
        {{ getLocalizedTitle(gallery) }}
      </button>
    </div>

    <div class="gallery-filters-mobile" *ngIf="galleries().length > 0 && isMobile">
  <select (change)="onCityChange($event)">
        <option *ngFor="let gallery of galleries()" [value]="gallery._id" [selected]="activeTab() === gallery._id">
          {{ getLocalizedTitle(gallery) }}
        </option>
      </select>
    </div>

    <div *ngIf="activeGallery() as gallery" class="modern-gallery">
      <div class="masonry-grid">
        <div 
          *ngFor="let photo of gallery.photos; let i = index" 
          class="masonry-item"
          (click)="openLightbox(i)"
        >
          <img 
            [src]="photo.asset.url" 
            [alt]="getPhotoAlt(photo, gallery, i)"
            loading="lazy"
          />
          <div class="image-overlay">
            <i class="fas fa-expand-alt"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="no-photos" *ngIf="galleries().length === 0">
      <div class="no-photos-content">
        <i class="fas fa-images"></i>
        <h3>{{ getTranslation('gallery.emptyTitle') }}</h3>
        <p>{{ getTranslation('gallery.emptyText') }}</p>
      </div>
    </div>
  </div>

  <div 
    *ngIf="isLightboxOpen()"
    class="lightbox-overlay"
    (click)="closeLightbox()"
    [@fadeIn]
  >
    <div class="lightbox-container" (click)="$event.stopPropagation()">
      
      <button class="lightbox-btn lightbox-close" (click)="closeLightbox()">
        <i class="fas fa-times"></i>
      </button>

      <div class="lightbox-counter">
        {{ currentImageIndex() + 1 }} / {{ currentImages().length }}
      </div>

      <button 
        *ngIf="currentImageIndex() > 0"
        class="lightbox-btn lightbox-prev"
        (click)="prevImage()"
      >
        <i class="fas fa-chevron-left"></i>
      </button>

      <button 
        *ngIf="currentImageIndex() < currentImages().length - 1"
        class="lightbox-btn lightbox-next"
        (click)="nextImage()"
      >
        <i class="fas fa-chevron-right"></i>
      </button>

      <div class="lightbox-content">
        <img 
          *ngIf="currentImage() as image"
          [src]="image.asset.url"
          [alt]="getPhotoAlt(image, activeGallery()!, currentImageIndex())"
          class="lightbox-image"
          [@zoomIn]
        />
      </div>
      
      <div class="lightbox-thumbs" *ngIf="currentImages().length > 1">
        <div 
          *ngFor="let photo of currentImages(); let i = index"
          class="thumb-item"
          [class.active]="i === currentImageIndex()"
          (click)="currentImageIndex.set(i)"
        >
          <img [src]="photo.asset.url" [alt]="photo.alt || 'Thumbnail'">
        </div>
      </div>
    </div>
  </div>
</section>